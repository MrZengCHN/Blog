<template>
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <!-- Breadcrumbs -->
        <div class="text-sm breadcrumbs mb-6 animate-fade-in-down">
            <ul>
                <li><router-link to="/">é¦–é¡µ</router-link></li>
                <li><router-link to="/blog">åšå®¢</router-link></li>
                <li>Clashå…¨å±€æ‰©å±•è„šæœ¬åˆ†äº«</li>
            </ul>
        </div>

        <!-- Header -->
        <div class="mb-8 text-center animate-fade-in-down">
            <h1
                class="text-4xl md:text-5xl font-bold mb-4 bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent">
                Clashå…¨å±€æ‰©å±•è„šæœ¬åˆ†äº«
            </h1>
            <div class="flex flex-wrap justify-center items-center gap-4 text-base-content/70 text-sm mb-8">
                <div class="flex items-center gap-2">
                    <span class="font-medium">Mr. Zeng</span>
                </div>
                <span class="hidden md:inline">â€¢</span>
                <span>2025å¹´12æœˆ4æ—¥</span>
                <span class="hidden md:inline">â€¢</span>
                <div class="flex gap-2">
                    <span class="badge badge-primary badge-outline">Clash</span>
                    <span class="badge badge-secondary badge-outline">JavaScript</span>
                    <span class="badge badge-accent badge-outline">Proxy</span>
                </div>
            </div>

            <figure
                class="w-full aspect-video md:aspect-[21/9] overflow-hidden rounded-2xl shadow-2xl bg-base-200 mb-8">
                <img src="@/assets/blogs/202512/ClashGlobalExtension/cover.jpg" alt="Clash Global Extension Script"
                    class="w-full h-full object-cover hover:scale-105 transition-transform duration-500" />
            </figure>
        </div>

        <article
            class="prose lg:prose-xl mx-auto bg-base-100 p-8 rounded-box shadow-lg animate-fade-in-up animation-delay-300">
            <!-- Introduction -->
            <section class="mb-12">
                <h2 class="text-2xl font-bold mb-4 flex items-center gap-2">
                    <span class="text-primary">#</span> è„šæœ¬ä»‹ç»
                </h2>

                <!-- Comic Strip -->
                <div class="mb-8 text-center">
                    <img :src="comicImg" alt="Clash Script Comic"
                        class="rounded-lg shadow-lg max-w-full md:max-w-2xl mx-auto cursor-zoom-in hover:shadow-xl transition-shadow duration-300"
                        @click="showComicPreview = true" />
                    <p class="text-sm text-base-content/60 mt-2">ç‚¹å‡»æŸ¥çœ‹å¤§å›¾</p>
                </div>
                <div class="bg-base-200 p-6 rounded-lg border-l-4 border-primary">
                    <p class="mb-4">
                        Clash æ˜¯ä¸€æ¬¾éå¸¸å¼ºå¤§çš„ä»£ç†å·¥å…·ï¼Œè€Œå®ƒçš„å…¨å±€æ‰©å±•è„šæœ¬ï¼ˆGlobal Extension Scriptï¼‰åŠŸèƒ½æ›´æ˜¯è®©é…ç½®çš„çµæ´»æ€§ä¸Šäº†ä¸€ä¸ªå°é˜¶ã€‚
                    </p>
                    <p>
                        è¿™ä¸ªè„šæœ¬çš„ä¸»è¦ç”¨é€”æ˜¯è‡ªåŠ¨æ ¹æ®ä»£ç†èŠ‚ç‚¹çš„åç§°ï¼Œå°†å…¶å½’ç±»åˆ°å¯¹åº”çš„å›½å®¶/åœ°åŒºåˆ†ç»„ä¸­ï¼Œå¹¶ç”Ÿæˆç›¸åº”çš„ç­–ç•¥ç»„ã€‚
                        è¿™æ ·ï¼Œæ— è®ºä½ çš„æœºåœºèŠ‚ç‚¹å¦‚ä½•å˜åŒ–ï¼Œåªè¦åç§°ä¸­åŒ…å«ç‰¹å®šçš„å…³é”®å­—ï¼Œå°±èƒ½è‡ªåŠ¨åˆ†æµï¼Œæ— éœ€æ‰‹åŠ¨ç»´æŠ¤ç¹ççš„é…ç½®ã€‚
                    </p>
                </div>
            </section>

            <!-- Script Share -->
            <section class="mb-12">
                <h2 class="text-2xl font-bold mb-4 flex items-center gap-2">
                    <span class="text-secondary">#</span> è„šæœ¬åˆ†äº«
                </h2>
                <div class="mockup-code bg-[#282c34] text-[#abb2bf] shadow-xl relative group">
                    <button @click="copyCode"
                        class="absolute top-4 right-4 btn btn-sm btn-ghost text-white opacity-0 group-hover:opacity-100 transition-opacity"
                        :class="{ 'text-success': copied }">
                        <span v-if="!copied">ğŸ“‹ å¤åˆ¶</span>
                        <span v-else>âœ… å·²å¤åˆ¶</span>
                    </button>
                    <pre v-for="(line, index) in scriptLines" :key="index"
                        :data-prefix="index + 1"><code>{{ line }}</code></pre>
                </div>
            </section>

            <!-- Effect Display -->
            <section>
                <h2 class="text-2xl font-bold mb-4 flex items-center gap-2">
                    <span class="text-accent">#</span> æ•ˆæœå±•ç¤º
                </h2>
                <div class="overflow-hidden rounded-xl shadow-lg border border-base-300">
                    <img src="@/assets/blogs/202512/ClashGlobalExtension/effect.png" alt="Clash Global Extension Effect"
                        class="w-full h-auto hover:scale-[1.02] transition-transform duration-300" />
                </div>
            </section>
        </article>

        <!-- Navigation -->
        <div
            class="flex justify-between items-center mt-12 pt-8 border-t border-base-200 animate-fade-in-up animation-delay-500">
            <router-link to="/blogs/202512/ai-prompt-tool" class="btn btn-outline gap-2 group">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 group-hover:-translate-x-1 transition-transform"
                    fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                </svg>
                <div class="text-left">
                    <div class="text-xs opacity-50 font-normal">ä¸Šä¸€ç¯‡</div>
                    <div class="font-bold">AI æç¤ºè¯å·¥å…·</div>
                </div>
            </router-link>

            <button class="btn btn-outline gap-2 group" disabled>
                <div class="text-right">
                    <div class="text-xs opacity-50 font-normal">ä¸‹ä¸€ç¯‡</div>
                    <div class="font-bold">æ²¡æœ‰äº†</div>
                </div>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 group-hover:translate-x-1 transition-transform"
                    fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                </svg>
            </button>
        </div>
        <!-- Image Preview Modal -->
        <div v-if="showComicPreview"
            class="fixed inset-0 z-50 flex items-center justify-center bg-black/90 backdrop-blur-sm p-4 cursor-zoom-out transition-all duration-300"
            @click="showComicPreview = false">
            <img :src="comicImg" alt="Clash Script Comic Full"
                class="max-w-full max-h-full rounded-lg shadow-2xl animate-scale-up" @click.stop />
            <button class="absolute top-4 right-4 btn btn-circle btn-ghost text-white"
                @click="showComicPreview = false">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </div>
    </div>
</template>

<script setup>
import { ref, computed, onMounted } from 'vue'
import comicImg from '@/assets/blogs/202512/ClashGlobalExtension/comic.jpg'

onMounted(() => {
    window.scrollTo(0, 0)
})

const copied = ref(false)
const showComicPreview = ref(false)

const scriptContent = `function main(config, profileName) {
    // 1. é…ç½®å¸¸é‡
    const TEST_URL = "http://www.gstatic.com/generate_204";
    const TEST_INTERVAL = 6000;

    // 2. å®šä¹‰å›½å®¶è§„åˆ™ï¼ˆæå–å‡ºæ¥ä»¥ä¿æŒ main å‡½æ•°æ•´æ´ï¼‰
    const countriesConfig = [
        { name: "ğŸ‡ºğŸ‡¸ ç¾å›½", keywords: ["ç¾å›½", "United States", "US"] },
        { name: "ğŸ‡¯ğŸ‡µ æ—¥æœ¬", keywords: ["æ—¥æœ¬", "Japan", "JP"] },
        { name: "ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡", keywords: ["æ–°åŠ å¡", "Singapore", "SG"] },
        { name: "ğŸ‡¹ğŸ‡¼ å°æ¹¾", keywords: ["å°æ¹¾", "Taiwan", "TW", "CN_TW"] },
        { name: "ğŸ‡­ğŸ‡° é¦™æ¸¯", keywords: ["é¦™æ¸¯", "Hong Kong", "HK", "CN_HK"] },
        { name: "ğŸ‡©ğŸ‡ª å¾·å›½", keywords: ["å¾·å›½", "Germany", "DE"] },
        { name: "ğŸ‡¬ğŸ‡§ è‹±å›½", keywords: ["è‹±å›½", "United Kingdom", "UK", "GB"] },
        { name: "ğŸ‡«ğŸ‡· æ³•å›½", keywords: ["æ³•å›½", "France", "FR"] },
        { name: "ğŸ‡¨ğŸ‡¦ åŠ æ‹¿å¤§", keywords: ["åŠ æ‹¿å¤§", "Canada", "CA"] },
        { name: "ğŸ‡°ğŸ‡· éŸ©å›½", keywords: ["éŸ©å›½", "Korea", "KR"] },
        { name: "ğŸ‡¦ğŸ‡º æ¾³å¤§åˆ©äºš", keywords: ["æ¾³å¤§åˆ©äºš", "Australia", "AU"] },
        { name: "ğŸ‡¦ğŸ‡ª é˜¿è”é…‹", keywords: ["é˜¿è”é…‹", "UAE", "Dubai"] },
        { name: "ğŸ‡²ğŸ‡´ æ¾³é—¨", keywords: ["æ¾³é—¨", "Macau", "MO"] },
        { name: "ğŸ‡®ğŸ‡³ å°åº¦", keywords: ["å°åº¦", "India", "IN"] },
        { name: "ğŸ‡§ğŸ‡· å·´è¥¿", keywords: ["å·´è¥¿", "Brazil", "BR"] },
        { name: "ğŸ‡·ğŸ‡º ä¿„ç½—æ–¯", keywords: ["ä¿„ç½—æ–¯", "Russia", "RU"] },
        { name: "ğŸ‡¹ğŸ‡· åœŸè€³å…¶", keywords: ["åœŸè€³å…¶", "Turkey", "TR"] },
        { name: "ğŸ‡¹ğŸ‡­ æ³°å›½", keywords: ["æ³°å›½", "Thailand", "TH"] },
        { name: "ğŸ‡²ğŸ‡¾ é©¬æ¥è¥¿äºš", keywords: ["é©¬æ¥è¥¿äºš", "Malaysia", "MY"] },
        { name: "ğŸ‡»ğŸ‡³ è¶Šå—", keywords: ["è¶Šå—", "Vietnam", "VN"] },
        { name: "ğŸ‡µğŸ‡­ è²å¾‹å®¾", keywords: ["è²å¾‹å®¾", "Philippines", "PH"] },
        { name: "ğŸ‡¦ğŸ‡· é˜¿æ ¹å»·", keywords: ["é˜¿æ ¹å»·", "Argentina", "AR"] },
        { name: "ğŸ‡°ğŸ‡¿ å“ˆè¨å…‹æ–¯å¦", keywords: ["å“ˆè¨å…‹æ–¯å¦", "Kazakhstan", "KZ"] },
        { name: "ğŸ‡ªğŸ‡¬ åŸƒåŠ", keywords: ["åŸƒåŠ", "Egypt", "EG"] },
        { name: "ğŸ‡µğŸ‡° å·´åŸºæ–¯å¦", keywords: ["å·´åŸºæ–¯å¦", "Pakistan", "PK"] },
        { name: "ğŸ‡³ğŸ‡¬ å°¼æ—¥åˆ©äºš", keywords: ["å°¼æ—¥åˆ©äºš", "Nigeria", "NG"] },
        { name: "ğŸ‡ºğŸ‡¦ ä¹Œå…‹å…°", keywords: ["ä¹Œå…‹å…°", "Ukraine", "UA"] },
        { name: "ğŸ‡°ğŸ‡­ æŸ¬åŸ”å¯¨", keywords: ["æŸ¬åŸ”å¯¨", "Cambodia", "KH"] },
        { name: "ğŸ‡²ğŸ‡² ç¼…ç”¸", keywords: ["ç¼…ç”¸", "Myanmar", "MM"] },
        { name: "ğŸ‡¦ğŸ‡¶ å—ææ´²", keywords: ["å—ææ´²", "Antarctica", "AQ"] }
    ];

    // 3. åˆå§‹åŒ– Map å®¹å™¨ï¼Œä¿æŒæ’å…¥é¡ºåº
    // ç»“æ„: Map { "ç¾å›½" => [], "æ—¥æœ¬" => [], ... }
    const countryMap = new Map();
    countriesConfig.forEach(c => countryMap.set(c.name, {
        proxies: [],
        keywords: c.keywords
    }));

    const proxies = config.proxies || [];

    // 4. é«˜æ•ˆéå†ï¼šåªéå†ä¸€æ¬¡ä»£ç†åˆ—è¡¨ (Performance Fix)
    // åŸå§‹é€»è¾‘æ˜¯ï¼šå›½å®¶ -> éå†æ‰€æœ‰ä»£ç† (N * M)
    // ä¼˜åŒ–é€»è¾‘æ˜¯ï¼šä»£ç† -> æ‰¾åˆ°åŒ¹é…çš„ç¬¬ä¸€ä¸ªå›½å®¶ (N * 1)
    proxies.forEach(proxy => {
        // æŸ¥æ‰¾è¯¥ä»£ç†ç¬¦åˆå“ªä¸ªå›½å®¶ï¼ˆæ‰¾åˆ°ç¬¬ä¸€ä¸ªå³åœæ­¢ï¼Œé¿å…é‡å¤å½’ç±»ï¼‰
        const matchedCountry = countriesConfig.find(c =>
            c.keywords.some(keyword => proxy.name.includes(keyword))
        );

        if (matchedCountry) {
            countryMap.get(matchedCountry.name).proxies.push(proxy.name);
        }
    });

    // 5. ç»„è£…ç­–ç•¥ç»„
    const countryGroups = [];
    const mainGroupProxies = [];

    // éå† Map ç”Ÿæˆæœ€ç»ˆé…ç½®
    for (const [name, data] of countryMap) {
        // åªæœ‰å½“è¯¥å›½å®¶æœ‰èŠ‚ç‚¹æ—¶ï¼Œæ‰åˆ›å»ºåˆ†ç»„
        if (data.proxies.length > 0) {
            // æ·»åŠ åˆ°ä¸»é€‰æ‹©ç»„çš„åˆ—è¡¨ä¸­
            mainGroupProxies.push(name);

            // åˆ›å»ºè¯¥å›½å®¶çš„ url-test ç»„
            countryGroups.push({
                "name": name,
                "type": "url-test",
                "url": TEST_URL,
                "interval": TEST_INTERVAL,
                "tolerance": 50, // å»ºè®®åŠ ä¸Šå®¹å·®ï¼Œé¿å…é¢‘ç¹åˆ‡æ¢
                "proxies": data.proxies
            });
        }
    }

    // ä¸»æ‰‹åŠ¨é€‰æ‹©ç»„
    const mainGroup = {
        "name": profileName,
        "type": "select",
        "proxies": mainGroupProxies.length > 0 ? mainGroupProxies : ["DIRECT"] // é˜²æ­¢ä¸ºç©ºæŠ¥é”™
    };

    // 6. è¦†ç›–é…ç½®
    // æ³¨æ„ï¼šè¿™é‡Œä¼šå°†åŸæœ‰çš„ proxy-groups å®Œå…¨è¦†ç›–ã€‚å¦‚æœæƒ³ä¿ç•™åŸæœ‰çš„ï¼ˆå¦‚è‡ªåŠ¨é€‰æ‹©ç­‰ï¼‰ï¼Œéœ€è¦æ”¹ä¸º push
    config["proxy-groups"] = [mainGroup, ...countryGroups];

    return config;
}`

const scriptLines = computed(() => scriptContent.split('\n'))

const copyCode = async () => {
    try {
        await navigator.clipboard.writeText(scriptContent)
        copied.value = true
        setTimeout(() => {
            copied.value = false
        }, 2000)
    } catch (err) {
        console.error('Failed to copy:', err)
    }
}
</script>

<style scoped>
@keyframes fadeInDown {
    from {
        opacity: 0;
        transform: translate3d(0, -20px, 0);
    }

    to {
        opacity: 1;
        transform: translate3d(0, 0, 0);
    }
}

.animate-fade-in-down {
    animation: fadeInDown 0.8s ease-out both;
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translate3d(0, 20px, 0);
    }

    to {
        opacity: 1;
        transform: translate3d(0, 0, 0);
    }
}

.animate-fade-in-up {
    animation: fadeInUp 0.8s ease-out both;
}

.animation-delay-300 {
    animation-delay: 0.3s;
}

.animation-delay-500 {
    animation-delay: 0.5s;
}

@keyframes scaleUp {
    from {
        opacity: 0;
        transform: scale(0.9);
    }

    to {
        opacity: 1;
        transform: scale(1);
    }
}

.animate-scale-up {
    animation: scaleUp 0.3s ease-out both;
}
</style>
